var width=456,height=285,radius=3;var data=[[70.9,38.1],[121.4,76],[171.8,97.8],[222.2,121.5],[272.6,156.3],[323,175],[373.4,188],[423.8,201.4]];var svg=d3.select("body").append("svg").attr("viewBox","0, 0, "+width+", "+height).attr("preserveAspectRatio","xMinYMid");var path=svg.append("path").datum(data).attr("d",d3.line()).call(transitionStyle);var circle=svg.selectAll("circle").data(data).enter().append("circle").attr("r",radius).attr("cx",function(d){return d[0]}).attr("cy",function(d){return d[1]}).call(transitionVisibility);function transitionVisibility(){svg.selectAll("circle").transition().duration(2e3).styleTween("visibility",visibilityTween)}function transitionStyle(path,l0,l1){l0=typeof l0==="undefined"?0:l0;l1=typeof l1==="undefined"?path.node().getTotalLength():l1;path.transition().duration(2e3).styleTween("stroke-dasharray",dashTween(l0,l1)).on("end",function(){d3.select(this).call(transitionStyle,l1,l0)})}function visibilityTween(d,i){var totalLength=svg.select("path").node().getTotalLength();var myLength=svg.append("path").attr("d",d3.line()(data.slice(0,i+1))).remove().node().getTotalLength();console.log("visibilityTween",i,myLength,totalLength);return function(t){return myLength-radius<=t*totalLength?"visible":"hidden"}}function dashTween(l0,l1){return function(){var l=this.getTotalLength(),i=d3.interpolateString(l0+","+l1,l1+","+l);return function(t){return i(t)}}}