d3.colorado=function(){function t(t,e,a,r,c){t&&console.log(t);var u=Object.keys(r.objects).map(function(t){return topojson.feature(r,r.objects[t])});P.append("path").datum(topojson.merge(e,e.objects.ok.geometries)).attr("class","state").attr("d",A),P.append("path").datum(topojson.mesh(e,e.objects.ok,function(t,e){return t!==e})).attr("class","county").attr("d",A),P.selectAll("path.basin").data(u[0].features).enter().append("path").attr("class","basin").attr("d",A).on("mouseover",i).on("mouseout",d),P.selectAll("path.play").data(u[1].features).enter().append("path").attr("class","play").attr("d",A).on("mouseover",o).on("mouseout",d),P.selectAll("path.well").data(a).enter().append("path").attr("class","well").attr("d",function(t){return A(t.location)}).on("mouseover",l).on("mouseout",d),I.attr("id","well-label").style("left",m-100+"px").text(y(a.length)+" wells"),P.selectAll("path.quake").data(c.features.filter(function(t){return+t.properties.mag>=2.5})).enter().append("path").attr("class","quake").attr("d",A).on("mouseover",s).on("mouseout",d),n(),p()}function e(){E.text(a(j.invert(d3.mouse(this)),2*b().scale*Math.PI)),c()}function a(t,e){var a=d3.format("."+Math.floor(Math.log(e)/2)+"f");return(t[1]<0?a(-t[1])+"\xb0S":a(t[1])+"\xb0N")+" "+(t[0]<0?a(-t[0])+"\xb0W":a(t[0])+"\xb0E")}function r(){z.selectAll("image").remove(),n()}function n(){function t(t){return url.indexOf("mqcdn")>-1?"http://otile"+["1","2","3","4"][0|4*Math.random()]+url+t[2]+"/"+t[0]+"/"+t[1]+".png":"http://"+["a","b","c"][0|3*Math.random()]+url+t[2]+"/"+t[0]+"/"+t[1]+".png"}var e=b.scale(M.scale()).translate(M.translate())();P.attr("transform","translate("+M.translate()+")scale("+M.scale()/v+")").style("stroke-width",v/M.scale()),A.pointRadius(4.5*v/M.scale()),P.selectAll("path.quake").attr("d",A),P.selectAll("path.well").attr("d",function(t){return A(t.location)}),j.scale(M.scale()/2/Math.PI).translate(M.translate());var a;if(X.each(function(){this.checked&&(a=this.value)}),url=x[a]){var r=z.attr("transform","scale("+e.scale+")translate("+e.translate+")").selectAll("image").data(e,function(t){return t});r.exit().remove(),r.enter().append("image").attr("xlink:href",t).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]})}}function l(t){var e=Object.keys(t);e.splice(e.indexOf("location"),1),e.splice(e.indexOf("ts"),1);var a=null==e?["No data"]:e.map(function(e){return e+": "+t[e]});S.html(a.join().replace(/,/g,"<br>")).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),d3.selectAll("path.well.active").classed("active",!1),d3.select(this).classed("active",!0)}function s(t){"hidden"!=d3.select(this).style("visibility")&&(S.html(t.properties.title+"<br>Depth: "+t.geometry.coordinates[2]+" km"+"<br>Date: "+h(new Date(t.properties.time))).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"))}function i(t){S[0][0].innerHTML=t.properties.NAME+" (basin)",S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function o(t){var e=t.properties.Shale_Play+" (play)";S[0][0].innerHTML=e,S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function c(){S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function d(){S.style("visibility","hidden")}var p,u=function(t){return p=t,u},m=700,f=400,x=[".tiles.mapbox.com/v3/examples.map-i86nkdio/",".tiles.mapbox.com/v3/brunosan.map-cyglrrfu/",".mqcdn.com/tiles/1.0.0/map/",".mqcdn.com/tiles/1.0.0/sat/",".tile.thunderforest.com/landscape/",".tile.thunderforest.com/cycle/",".tile.stamen.com/terrain-background/",".tile.stamen.com/toner/",".tile.stamen.com/watercolor/",""],h=d3.time.format("%c"),y=d3.format(",.0f"),g=6.75,v=Math.pow(2,8+g),b=d3.geo.tile().size([m,f]),k=d3.geo.mercator().scale(v/2/Math.PI).translate([0,0]),j=d3.geo.mercator(),w=k([-98.75,35.5]),A=d3.geo.path().projection(k),M=d3.behavior.zoom().scale(2*k.scale()*Math.PI).scaleExtent([v,1<<23]).center([m/2,f/2]).translate([m/2-w[0],f/2-w[1]]).on("zoom",n),q=d3.select("body").append("div").attr("class","map").style("width",m+"px").style("height",f+"px").call(M).on("mousemove",e),D=q.append("svg").style("width",m+"px").style("height",f+"px"),z=D.append("g"),P=D.append("g"),E=q.append("div").attr("class","info"),I=q.append("div").attr("class","info"),S=d3.select("body").append("div").attr("class","tooltip").style("pointer-events","none").style("visibility","hidden"),X=d3.selectAll("#myRadios input").on("change",r);return queue().defer(d3.json,"ok.json").defer(d3.json,"junk.json").defer(d3.json,"shalegasplay.json").defer(d3.json,"quakes.json").defer(d3.csv,"wells.csv").await(t),u.tooltip=function(){d3.select("div.tooltip").remove(),S=d3.select("body").append("div").attr("class","tooltip").style("pointer-events","none").style("visibility","hidden")},u},d3.timeseries=function(){function t(l){function c(t,n,s){if(t)throw t;a=n,s.features=s.features.filter(function(t){return+t.properties.mag>=o}),r=s,e([]),l()}return arguments.length||(l=function(){console.log("Done initializing d3.timeseries")}),null!==d3.select("#wells").node()?a:(n=d3.select("body").append("svg").attr("id","timeseries").attr("width",s).attr("height",i),queue().defer(d3.json,"junk.json").defer(d3.json,"quakes.json").await(c),t)}function e(t,e){var a={top:20,right:80,bottom:50,left:80},r=+n.attr("width")-a.left-a.right,s=+n.attr("height")/2-a.top-a.bottom,i=d3.extent(t.map(function(t){return t.y})),o=d3.scale.linear().domain(i).range([s,0]),c=d3.extent(t.map(function(t){return t.tbg}));c[1]=d3.max([c[1],e]);var d=d3.scale.linear().domain(c).range([s,0]),p=d3.svg.line().x(function(t){return x(t.x)}).y(function(t){return o(t.y)}),u=d3.svg.area().x(function(t){return x(t.x)}).y0(s).y1(function(t){return o(t.y)});l||(l=n.append("g").attr("id","myTimeSeries").attr("transform","translate("+a.left+","+(+n.attr("height")/2+a.top)+")"),l.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")"),l.append("g").attr("class","y axis"),l.append("g").attr("class","p axis").attr("transform","translate("+r+", 0)"),l.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-s/2).attr("y",-8-a.left/3).attr("dy","-.75em").attr("transform","rotate(-90)").style("fill","steelblue").text("Injection Volume"),l.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-8).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","steelblue").text("barrels/month"),l.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-s/2).attr("y",r+a.right).attr("dy","-.75em").attr("transform","rotate(-90)").style("fill","red").text("Tubing Pressure"),l.append("text").attr("class","p label").attr("text-anchor","end").attr("x",-8).attr("y",r-18).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","red").text("PSI"),l.append("text").attr("class","maxp label").attr("text-anchor","end").attr("x",r).attr("y","0em").style("fill","red").style("font-size","0.7em"),l.append("text").attr("class","api-number").style("text-anchor","end").attr("x",r).attr("y","-2.2em").text("select a well (on map)"),l.append("text").attr("class","formation-code").style("text-anchor","end").attr("y","-1.2em").attr("x",r).text("")),"undefined"==typeof x&&(x=d3.time.scale().domain(d3.extent(t.map(function(t){return t.x}))).range([0,r]));var m=l,f=m.selectAll("path.injection-volume").data([t]);f.attr("d",p),f.enter().append("path").attr("class","injection-volume").attr("d",p),f.exit().remove();var h=m.selectAll("path.area").data([t]);h.enter().append("path").attr("class","area").style("fill-opacity",.8).style("fill","steelblue").attr("d",u),h.attr("d",u),h.exit().remove();var y=m.selectAll("path.pressure").data([t]);p.y(function(t){return d(t.tbg)}),y.enter().append("path").attr("class","pressure").attr("d",p),y.attr("d",p),y.exit().remove();var g=e?[{x:x.domain()[0],tbg:e},{x:x.domain()[1],tbg:e}]:[],v=m.selectAll("path.pressure-limit").data([g]);v.attr("d",p),v.enter().append("path").attr("class","pressure-limit").attr("d",p),v.exit().remove();var b=d3.select(".maxp.label").text("");e&&b.attr("y",d(e)-5).text("maximum pressure limit");var k=d3.svg.axis().scale(x).ticks(3).orient("bottom"),j=d3.svg.axis().scale(o).ticks(5).tickFormat(d3.format("s")).orient("left"),w=d3.svg.axis().scale(d).ticks(5).tickFormat(d3.format("s")).orient("right");m.selectAll("g.y.axis").call(j),m.selectAll("g.x.axis").call(k),m.selectAll("g.p.axis").call(w),m.selectAll(".y.axis text").style("fill","steelblue"),m.selectAll(".p.axis text").style("fill","red")}var a,r,n,l,s=360,i=500,o=2.5;return t.plotem=function(){function a(t){var a="";Object.keys(t.metadata).forEach(function(e){a+=e+": "+t.metadata[e]+"<br>"}),d3.select(".tooltip").html(a).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),d3.selectAll("path.well.active").classed("active",!1),d3.select(this).classed("active",!0);var r=t.ts.map(function(t){return{x:new Date(t.date),y:+t.vol,tbg:+t.prs,csg:null}}),n=null,l=null;e(r,n,l),d3.select(".api-number").text("API Number: "+t.api)}return d3.selectAll("path.well").on("mouseover",a),t},t.plotQuakes=function(){var e=n.select("g").selectAll("path.quake").data(r.features);e.exit().remove(),e.attr("d",function(t){return path(t.values.location)}),e.enter().append("path").attr("class","quake").attr("d",path).on("mouseover",l);var a=n.selectAll(".quakesLabel").data([format(r.features.length)+" earthquakes"]);return a.enter().append("text").attr("class","quakesLabel").attr("x",.7*s).attr("y",.1*i).attr("dy","1.1em").style("font-size","20px").text(String),a.text(String),t;var l},t.plotQuakeSeries=function(){function e(){function t(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=u.extent();u.empty()&&(e=a(e[0][0]),d3.selectAll(".brush").call(u.extent(e))),d3.selectAll("path.quake").style("pointer-events",function(e){return 1==t(e)?"all":"none"}).style("visibility",function(e){return 1==t(e)?"visible":"hidden"});var r=d3.selectAll("path.quake").filter(t)[0].length;d3.select(".quakesLabel").html(r+" earthquakes")}function a(t){var e=new Date,a=new Date(t);return a=a<x.domain()[1]?a:x.domain()[1],e.setDate(a.getDate()-30),[[e,c.domain()[0]],[a,c.domain()[1]]]}var l={top:30,right:80,bottom:80,left:80},s=+n.attr("width")-l.left-l.right,i=+n.attr("height")/2-l.top-l.bottom,o=n.append("g").attr("transform","translate("+l.left+","+l.top+")");x=d3.time.scale().domain(d3.extent(r.features.map(function(t){return t.properties.time}))).range([0,s]);var c=d3.scale.linear().domain(d3.extent(r.features.map(function(t){return+t.properties.mag}))).range([i,0]),d=d3.svg.axis().scale(x).ticks(3).orient("bottom"),p=d3.svg.axis().scale(c).ticks(5).orient("left");o.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-6).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text("magnitude"),o.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",s/2).attr("y",-l.top/2).attr("dy","+.75em").text("Earthquakes");var u=d3.svg.brush().x(x).y(c).extent(a(x.domain()[1])).on("brush",e);return o.selectAll("circle.quake").data(r.features).enter().append("circle").attr("class","quake").attr("cx",function(t){return x(+t.properties.time)}).attr("cy",function(t){return c(+t.properties.mag)}).attr("r",3),o.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(d),o.append("g").attr("class","q axis").call(p),o.attr("class","brush").call(u),e(),t},t.quakes=function(e){return arguments.length?(r=e,t):r},t.wells=function(e){return arguments.length?(a=e,t):a},t},d3.geo.tile=function(){function t(){var t=Math.max(Math.log(a)/Math.LN2-8,0),l=Math.round(t+n),s=Math.pow(2,t-l+8),i=[(r[0]-a/2)/s,(r[1]-a/2)/s],o=[],c=d3.range(Math.max(0,Math.floor(-i[0])),Math.max(0,Math.ceil(e[0]/s-i[0]))),d=d3.range(Math.max(0,Math.floor(-i[1])),Math.max(0,Math.ceil(e[1]/s-i[1])));return d.forEach(function(t){c.forEach(function(e){o.push([e,t,l])})}),o.translate=i,o.scale=s,o}var e=[960,500],a=256,r=[e[0]/2,e[1]/2],n=0;return t.size=function(a){return arguments.length?(e=a,t):e},t.scale=function(e){return arguments.length?(a=e,t):a},t.translate=function(e){return arguments.length?(r=e,t):r},t.zoomDelta=function(e){return arguments.length?(n=+e,t):n},t};