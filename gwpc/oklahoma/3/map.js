d3.colorado=function(){function T(t,r,i,s,u,a){t&&console.log(t);var f=Object.keys(s.objects).map(function(e){return topojson.feature(s,s.objects[e])});b.append("path").datum(topojson.merge(r,r.objects.ok.geometries)).attr("class","state").attr("d",d),b.append("path").datum(topojson.mesh(r,r.objects.ok,function(e,t){return e!==t})).attr("class","county").attr("d",d),b.selectAll("path.basin").data(f[0].features).enter().append("path").attr("class","basin").attr("d",d).on("mouseover",M).on("mouseout",P),b.selectAll("path.play").data(f[1].features).enter().append("path").attr("class","play").attr("d",d).on("mouseover",_).on("mouseout",P),b.selectAll("path.well").data(i).enter().append("path").attr("class","well").attr("d",function(e){return d(e.location)}).on("mouseover",A).on("mouseout",P),E.attr("id","well-label").style("left",n-100+"px").text(o(i.length)+" wells"),b.selectAll("path.quake").data(u.features.filter(function(e){return+e.properties.mag>=2.5})).enter().append("path").attr("class","quake").attr("d",d).on("mouseover",O).on("mouseout",P),L(),e()}function N(){w.text(C(h.invert(d3.mouse(this)),l().scale*2*Math.PI)),D()}function C(e,t){var n=d3.format("."+Math.floor(Math.log(t)/2)+"f");return(e[1]<0?n(-e[1])+"째S":n(e[1])+"째N")+" "+(e[0]<0?n(-e[0])+"째W":n(e[0])+"째E")}function k(){y.selectAll("image").remove(),L()}function L(){function r(e){return url.indexOf("mqcdn")>-1?"http://otile"+["1","2","3","4"][Math.random()*4|0]+url+e[2]+"/"+e[0]+"/"+e[1]+".png":"http://"+["a","b","c"][Math.random()*3|0]+url+e[2]+"/"+e[0]+"/"+e[1]+".png"}var e=l.scale(v.scale()).translate(v.translate())();b.attr("transform","translate("+v.translate()+")scale("+v.scale()/f+")").style("stroke-width",f/v.scale()),d.pointRadius(4.5*f/v.scale()),b.selectAll("path.quake").attr("d",d),b.selectAll("path.well").attr("d",function(e){return d(e.location)}),h.scale(v.scale()/2/Math.PI).translate(v.translate());var t;x.each(function(e,n){this.checked&&(t=this.value)}),url=i[t];if(!url)return;var n=y.attr("transform","scale("+e.scale+")translate("+e.translate+")").selectAll("image").data(e,function(e){return e});n.exit().remove(),n.enter().append("image").attr("xlink:href",r).attr("width",1).attr("height",1).attr("x",function(e){return e[0]}).attr("y",function(e){return e[1]})}function A(e){var t=Object.keys(e);t.splice(t.indexOf("location"),1),t.splice(t.indexOf("ts"),1);var n=t==null?["No data"]:t.map(function(t){return t+": "+e[t]});S.html(n.join().replace(/,/g,"<br>")).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),d3.selectAll("path.well.active").classed("active",!1),d3.select(this).classed("active",!0)}function O(e){if(d3.select(this).style("visibility")=="hidden")return;S.html(e.properties.title+"<br>Depth: "+e.geometry.coordinates[2]+" km"+"<br>Date: "+s(new Date(e.properties.time))).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function M(e){S[0][0].innerHTML=e.properties.NAME+" (basin)",S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function _(e){var t=e.properties.Shale_Play+" (play)";S[0][0].innerHTML=t,S.style("visibility","visible"),S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function D(e){S.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function P(e){S.style("visibility","hidden")}var e,t=function(n){return e=n,t},n=700,r=400,i=[".tiles.mapbox.com/v3/examples.map-i86nkdio/",".tiles.mapbox.com/v3/brunosan.map-cyglrrfu/",".mqcdn.com/tiles/1.0.0/map/",".mqcdn.com/tiles/1.0.0/sat/",".tile.thunderforest.com/landscape/",".tile.thunderforest.com/cycle/",".tile.stamen.com/terrain-background/",".tile.stamen.com/toner/",".tile.stamen.com/watercolor/",""],s=d3.time.format("%c"),o=d3.format(",.0f"),u,a=6.75,f=Math.pow(2,8+a),l=d3.geo.tile().size([n,r]),c=d3.geo.mercator().scale(f/2/Math.PI).translate([0,0]),h=d3.geo.mercator(),p=c([-98.75,35.5]),d=d3.geo.path().projection(c),v=d3.behavior.zoom().scale(c.scale()*2*Math.PI).scaleExtent([f,1<<23]).center([n/2,r/2]).translate([n/2-p[0],r/2-p[1]]).on("zoom",L),m=d3.select("body").append("div").attr("class","map").style("width",n+"px").style("height",r+"px").call(v).on("mousemove",N),g=m.append("svg").style("width",n+"px").style("height",r+"px"),y=g.append("g"),b=g.append("g"),w=m.append("div").attr("class","info"),E=m.append("div").attr("class","info"),S=d3.select("body").append("div").attr("class","tooltip").style("pointer-events","none").style("visibility","hidden"),x=d3.selectAll("#myRadios input").on("change",k);return queue().defer(d3.json,"ok.json").defer(d3.json,"junk.json").defer(d3.json,"shalegasplay.json").defer(d3.json,"quakes.json").defer(d3.csv,"wells.csv").await(T),t.tooltip=function(){d3.select("div.tooltip").remove(),S=d3.select("body").append("div").attr("class","tooltip").style("pointer-events","none").style("visibility","hidden")},t},d3.timeseries=function(){function a(s){function o(n,r,i){if(n)throw n;e=r,i.features=i.features.filter(function(e){return+e.properties.mag>=u}),t=i,p([]),s()}return arguments.length||(s=function(){console.log("Done initializing d3.timeseries")}),d3.select("#wells").node()!==null?e:(i=d3.select("body").append("svg").attr("id","timeseries").attr("width",n).attr("height",r),queue().defer(d3.json,"junk.json").defer(d3.json,"quakes.json").await(o),a)}function f(e){tooltip[0][0].innerHTML=e.properties.NAME+" Basin",tooltip.style("visibility","visible"),tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function l(e){var t=e.properties.Shale_Play+" Play";e.properties.Current==="Y"&&(t+=" (current)"),e.properties.Current==="N"&&(t+=" (prospective)"),tooltip[0][0].innerHTML=t,tooltip.style("visibility","visible"),tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function c(e){tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function h(e){tooltip.style("visibility","hidden")}function p(e,t,n){var r={top:20,right:80,bottom:50,left:80},o=+i.attr("width")-r.left-r.right,u=+i.attr("height")/2-r.top-r.bottom,a=d3.extent(e.map(function(e){return e.y})),f=d3.scale.linear().domain(a).range([u,0]),l=d3.extent(e.map(function(e){return e.tbg}));l[1]=d3.max([l[1],t]);var c=d3.scale.linear().domain(l).range([u,0]),h=d3.svg.line().x(function(e){return x(e.x)}).y(function(e){return f(e.y)}),p=d3.svg.area().x(function(e){return x(e.x)}).y0(u).y1(function(e){return f(e.y)});s||(s=i.append("g").attr("id","myTimeSeries").attr("transform","translate("+r.left+","+(+i.attr("height")/2+r.top)+")"),s.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")"),s.append("g").attr("class","y axis"),s.append("g").attr("class","p axis").attr("transform","translate("+o+", 0)"),s.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-u/2).attr("y",-8-r.left/3).attr("dy","-.75em").attr("transform","rotate(-90)").style("fill","steelblue").text("Injection Volume"),s.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-8).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","steelblue").text("barrels/month"),s.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-u/2).attr("y",o+r.right).attr("dy","-.75em").attr("transform","rotate(-90)").style("fill","red").text("Tubing Pressure"),s.append("text").attr("class","p label").attr("text-anchor","end").attr("x",-8).attr("y",o-18).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","red").text("PSI"),s.append("text").attr("class","maxp label").attr("text-anchor","end").attr("x",o).attr("y","0em").style("fill","red").style("font-size","0.7em"),s.append("text").attr("class","api-number").style("text-anchor","end").attr("x",o).attr("y","-2.2em").text("select a well (on map)"),s.append("text").attr("class","formation-code").style("text-anchor","end").attr("y","-1.2em").attr("x",o).text("")),typeof x=="undefined"&&(x=d3.time.scale().domain(d3.extent(e.map(function(e){return e.x}))).range([0,o]));var d=s,v=d.selectAll("path.injection-volume").data([e]);v.attr("d",h),v.enter().append("path").attr("class","injection-volume").attr("d",h),v.exit().remove();var m=d.selectAll("path.area").data([e]);m.enter().append("path").attr("class","area").style("fill-opacity",.8).style("fill","steelblue").attr("d",p),m.attr("d",p),m.exit().remove();var g=d.selectAll("path.pressure").data([e]);h.y(function(e){return c(e.tbg)}),g.enter().append("path").attr("class","pressure").attr("d",h),g.attr("d",h),g.exit().remove();var y=t?[{x:x.domain()[0],tbg:t},{x:x.domain()[1],tbg:t}]:[],b=d.selectAll("path.pressure-limit").data([y]);b.attr("d",h),b.enter().append("path").attr("class","pressure-limit").attr("d",h),b.exit().remove();var w=d3.select(".maxp.label").text("");t&&w.attr("y",c(t)-5).text("maximum pressure limit");var E=d3.svg.axis().scale(x).ticks(3).orient("bottom"),S=d3.svg.axis().scale(f).ticks(5).tickFormat(d3.format("s")).orient("left"),T=d3.svg.axis().scale(c).ticks(5).tickFormat(d3.format("s")).orient("right");d.selectAll("g.y.axis").call(S),d.selectAll("g.x.axis").call(E),d.selectAll("g.p.axis").call(T),d.selectAll(".y.axis text").style("fill","steelblue"),d.selectAll(".p.axis text").style("fill","red")}var e,t,n=360,r=500,i,s,o=4,u=2.5;return a.plotem=function(){function e(e){var t="";Object.keys(e.metadata).forEach(function(n){t+=n+": "+e.metadata[n]+"<br>"}),d3.select(".tooltip").html(t).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px"),d3.selectAll("path.well.active").classed("active",!1),d3.select(this).classed("active",!0);var n=e.ts.map(function(e){return{x:new Date(e.date),y:+e.vol,tbg:+e.prs,csg:null}}),r=null,i=null;p(n,r,i),d3.select(".api-number").text("API Number: "+e.api)}return d3.selectAll("path.well").on("mouseover",e),a},a.plotQuakes=function(){var e=i.select("g").selectAll("path.quake").data(t.features);e.exit().remove(),e.attr("d",function(e){return path(e.values.location)}),e.enter().append("path").attr("class","quake").attr("d",path).on("mouseover",o);var s=i.selectAll(".quakesLabel").data([format(t.features.length)+" earthquakes"]);s.enter().append("text").attr("class","quakesLabel").attr("x",.7*n).attr("y",.1*r).attr("dy","1.1em").style("font-size","20px").text(String),s.text(String);return a;var o},a.plotQuakeSeries=function(){function c(){function n(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=l.extent();l.empty()&&(e=h(e[0][0]),d3.selectAll(".brush").call(l.extent(e))),d3.selectAll("path.quake").style("pointer-events",function(e){return n(e)==1?"all":"none"}).style("visibility",function(e){return n(e)==1?"visible":"hidden"});var t=d3.selectAll("path.quake").filter(n)[0].length;d3.select(".quakesLabel").html(t+" earthquakes")}function h(e){var t=new Date,n=new Date(e);return n=n<x.domain()[1]?n:x.domain()[1],t.setDate(n.getDate()-30),[[t,o.domain()[0]],[n,o.domain()[1]]]}var e={top:30,right:80,bottom:80,left:80},n=+i.attr("width")-e.left-e.right,r=+i.attr("height")/2-e.top-e.bottom,s=i.append("g").attr("transform","translate("+e.left+","+e.top+")");x=d3.time.scale().domain(d3.extent(t.features.map(function(e){return e.properties.time}))).range([0,n]);var o=d3.scale.linear().domain(d3.extent(t.features.map(function(e){return+e.properties.mag}))).range([r,0]),u=d3.svg.axis().scale(x).ticks(3).orient("bottom"),f=d3.svg.axis().scale(o).ticks(5).orient("left");s.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-6).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text("magnitude"),s.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",n/2).attr("y",-e.top/2).attr("dy","+.75em").text("Earthquakes");var l=d3.svg.brush().x(x).y(o).extent(h(x.domain()[1])).on("brush",c);return s.selectAll("circle.quake").data(t.features).enter().append("circle").attr("class","quake").attr("cx",function(e){return x(+e.properties.time)}).attr("cy",function(e){return o(+e.properties.mag)}).attr("r",3),s.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(u),s.append("g").attr("class","q axis").call(f),s.attr("class","brush").call(l),c(),a},a.quakes=function(e){return arguments.length?(t=e,a):t},a.wells=function(t){return arguments.length?(e=t,a):e},a},d3.geo.tile=function(){function i(){var i=Math.max(Math.log(t)/Math.LN2-8,0),s=Math.round(i+r),o=Math.pow(2,i-s+8),u=[(n[0]-t/2)/o,(n[1]-t/2)/o],a=[],f=d3.range(Math.max(0,Math.floor(-u[0])),Math.max(0,Math.ceil(e[0]/o-u[0]))),l=d3.range(Math.max(0,Math.floor(-u[1])),Math.max(0,Math.ceil(e[1]/o-u[1])));return l.forEach(function(e){f.forEach(function(t){a.push([t,e,s])})}),a.translate=u,a.scale=o,a}var e=[960,500],t=256,n=[e[0]/2,e[1]/2],r=0;return i.size=function(t){return arguments.length?(e=t,i):e},i.scale=function(e){return arguments.length?(t=e,i):t},i.translate=function(e){return arguments.length?(n=e,i):n},i.zoomDelta=function(e){return arguments.length?(r=+e,i):r},i}