d3.wells=function(){function h(u){function a(e,o,a,c){a.features=a.features.filter(function(e){return+e.properties.mag>=n}),t=a;var h=o.objects.ok,g=topojson.merge(o,h.geometries),y=Object.keys(c.objects).map(function(e){return topojson.feature(c,c.objects[e])}),b=l.bounds(g),w=.95/Math.max((b[1][0]-b[0][0])/r,(b[1][1]-b[0][1])/i),E=[(r-w*(b[1][0]+b[0][0]))/2,(i-w*(b[1][1]+b[0][1]))/2];f.scale(w).translate(E);var S=s.append("g");S.append("path").datum(g).attr("class","state").attr("d",l),S.append("defs").append("clipPath").attr("id","state-clip").append("path").datum(g).attr("d",l),S.append("path").datum(topojson.mesh(o,h,function(e,t){return e!==t})).attr("class","county-border").attr("d",l),S.selectAll(".basin").data(y[0].features).enter().append("path").attr("class","basin").attr("clip-path","url(#state-clip)").attr("d",l).on("mouseover",p).on("mousemove",v).on("mouseout",m),S.selectAll(".play").data(y[1].features).enter().append("path").attr("class","play").classed("prospective",function(e){return e.properties.Current==="N"}).attr("clip-path","url(#state-clip)").attr("d",l).on("mouseover",d).on("mousemove",v).on("mouseout",m),u()}return arguments.length||(u=function(){console.log("Done initializing d3.wells")}),d3.select("#wells").node()!==null?h:(r=e[0],i=e[1],s=d3.select("body").append("svg").attr("width",r).attr("height",i),queue().defer(d3.json,"ok.json").defer(d3.json,"quakes.json").defer(d3.json,"shalegasplay.json").await(a),o=s.append("text").attr("x",.4*r).attr("y",.1*i).attr("dy","-1em").style("font-size","20px"),h)}function p(e){c[0][0].innerHTML=e.properties.NAME+" (basin)",c.style("visibility","visible"),c.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function d(e){var t=e.properties.Shale_Play+" (play)";e.properties.Current==="N"&&(t+=" (prospective)"),c[0][0].innerHTML=t,c.style("visibility","visible"),c.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function v(e){c.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function m(e){c.style("visibility","hidden")}function g(e,t){c.html(e.properties.title+"<br>Depth: "+e.geometry.coordinates[2]+" km"+"<br>Date: "+a(new Date(e.properties.time))).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}var e=[560,500],t,n=2.5,r,i,s,o,u=d3.format(",.0f"),a=d3.time.format("%c"),f=d3.geo.albers().scale(1).translate([0,0]),l=d3.geo.path().pointRadius(5).projection(f),c=d3.select("body").append("div").attr("class","tooltip").style("visibility","hidden");return h.plotem=function(){var e=s.selectAll("path.quake").data(t.features);return e.exit().remove(),e.attr("d",function(e){return l(e.values.location)}),e.enter().append("path").attr("class","quake").attr("d",l).on("mouseover",g).on("mouseout",m),h},h.plotTimeSeries=function(){function p(){function n(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=brush.extent();brush.empty()&&(e=d(e[0][0]),d3.selectAll(".brush").call(brush.extent(e))),d3.selectAll("path.quake").style("fill-opacity",function(e){return n(e)==1?.4:0}).style("pointer-events",function(e){return n(e)==1?"all":"none"});var t=d3.selectAll("path.quake").filter(n)[0].length;o.html(t+" Earthquakes")}function d(e){var t,n;return n=new Date(e),n.setFullYear(e.getFullYear()+1),n=n<a.domain()[1]?n:a.domain()[1],t=new Date(n),t.setFullYear(n.getFullYear()-2),[[t,f.domain()[0]],[n,f.domain()[1]]]}var e={top:10,right:20,bottom:50,left:80},n=400-e.left-e.right,r=200-e.top-e.bottom,i=t.features.map(function(e){return+e.properties.mag});d3.select("#myTimeSeries").remove();var s=d3.select("body").append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom).attr("id","myTimeSeries").append("g").attr("transform","translate("+e.left+","+e.top+")"),u=s.append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",r),a=d3.time.scale().domain(d3.extent(t.features.map(function(e){return e.properties.time}))).range([0,n]),f=d3.scale.linear().domain(d3.extent(t.features.map(function(e){return+e.properties.mag}))).range([r,0]),l=d3.svg.axis().scale(a).ticks(6).orient("bottom"),c=d3.svg.axis().scale(f).ticks(5).orient("left");return brush=d3.svg.brush().x(a).y(f).extent(d(a.domain()[1])).on("brush",p),s.selectAll("circle.quake").data(t.features).enter().append("circle").attr("class","quake").attr("cx",function(e){return a(+e.properties.time)}).attr("cy",function(e){return f(+e.properties.mag)}).attr("r",3),s.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(l),s.append("g").attr("class","y axis").call(c),s.attr("class","brush").call(brush),p(),h},h.size=function(t){return arguments.length?(e=t,h):e},h.data=function(e){return arguments.length?(t=e,h):t},h}