d3.wells=function(){function t(s){function m(t,u,d,m){d.features=d.features.filter(function(t){return+t.properties.mag>=c}),o=d;var h=u.objects.ok,v=topojson.merge(u,h.geometries),y=Object.keys(m.objects).map(function(t){return topojson.feature(m,m.objects[t])}),b=g.bounds(v),x=.95/Math.max((b[1][0]-b[0][0])/i,(b[1][1]-b[0][1])/l),j=[(i-x*(b[1][0]+b[0][0]))/2,(l-x*(b[1][1]+b[0][1]))/2];f.scale(x).translate(j);var k=p.append("g");k.append("path").datum(v).attr("class","state").attr("d",g),k.append("defs").append("clipPath").attr("id","state-clip").append("path").datum(v).attr("d",g),k.append("path").datum(topojson.mesh(u,h,function(t,e){return t!==e})).attr("class","county-border").attr("d",g),k.selectAll(".basin").data(y[0].features).enter().append("path").attr("class","basin").attr("clip-path","url(#state-clip)").attr("d",g).on("mouseover",e).on("mousemove",r).on("mouseout",n),k.selectAll(".play").data(y[1].features).enter().append("path").attr("class","play").classed("prospective",function(t){return"N"===t.properties.Current}).attr("clip-path","url(#state-clip)").attr("d",g).on("mouseover",a).on("mousemove",r).on("mouseout",n),s()}return arguments.length||(s=function(){console.log("Done initializing d3.wells")}),null!==d3.select("#wells").node()?t:(i=d[0],l=d[1],p=d3.select("body").append("svg").attr("width",i).attr("height",l),queue().defer(d3.json,"ok.json").defer(d3.json,"quakes.json").defer(d3.json,"shalegasplay.json").await(m),u=p.append("text").attr("x",.4*i).attr("y",.1*l).attr("dy","-1em").style("font-size","20px"),t)}function e(t){h[0][0].innerHTML=t.properties.NAME+" (basin)",h.style("visibility","visible"),h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function a(t){var e=t.properties.Shale_Play+" (play)";"N"===t.properties.Current&&(e+=" (prospective)"),h[0][0].innerHTML=e,h.style("visibility","visible"),h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function r(){h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function n(){h.style("visibility","hidden")}function s(t){h.html(t.properties.title+"<br>Depth: "+t.geometry.coordinates[2]+" km"+"<br>Date: "+m(new Date(t.properties.time))).style("visibility","visible").style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}var o,i,l,p,u,d=[560,500],c=2.5,m=(d3.format(",.0f"),d3.time.format("%c")),f=d3.geo.albers().scale(1).translate([0,0]),g=d3.geo.path().pointRadius(5).projection(f),h=d3.select("body").append("div").attr("class","tooltip").style("visibility","hidden");return t.plotem=function(){var e=p.selectAll("path.quake").data(o.features);return e.exit().remove(),e.attr("d",function(t){return g(t.values.location)}),e.enter().append("path").attr("class","quake").attr("d",g).on("mouseover",s).on("mouseout",n),t},t.plotTimeSeries=function(){function e(){function t(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=brush.extent();brush.empty()&&(e=a(e[0][0]),d3.selectAll(".brush").call(brush.extent(e))),d3.selectAll("path.quake").style("fill-opacity",function(e){return 1==t(e)?.4:0}).style("pointer-events",function(e){return 1==t(e)?"all":"none"});var r=d3.selectAll("path.quake").filter(t)[0].length;u.html(r+" Earthquakes")}function a(t){var e,a;return a=new Date(t),a.setFullYear(t.getFullYear()+1),a=a<l.domain()[1]?a:l.domain()[1],e=new Date(a),e.setFullYear(a.getFullYear()-2),[[e,p.domain()[0]],[a,p.domain()[1]]]}var r={top:10,right:20,bottom:50,left:80},n=400-r.left-r.right,s=200-r.top-r.bottom;o.features.map(function(t){return+t.properties.mag}),d3.select("#myTimeSeries").remove();var i=d3.select("body").append("svg").attr("width",n+r.left+r.right).attr("height",s+r.top+r.bottom).attr("id","myTimeSeries").append("g").attr("transform","translate("+r.left+","+r.top+")");i.append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",s);var l=d3.time.scale().domain(d3.extent(o.features.map(function(t){return t.properties.time}))).range([0,n]),p=d3.scale.linear().domain(d3.extent(o.features.map(function(t){return+t.properties.mag}))).range([s,0]),d=d3.svg.axis().scale(l).ticks(6).orient("bottom"),c=d3.svg.axis().scale(p).ticks(5).orient("left");return brush=d3.svg.brush().x(l).y(p).extent(a(l.domain()[1])).on("brush",e),i.selectAll("circle.quake").data(o.features).enter().append("circle").attr("class","quake").attr("cx",function(t){return l(+t.properties.time)}).attr("cy",function(t){return p(+t.properties.mag)}).attr("r",3),i.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(d),i.append("g").attr("class","y axis").call(c),i.attr("class","brush").call(brush),e(),t},t.size=function(e){return arguments.length?(d=e,t):d},t.data=function(e){return arguments.length?(o=e,t):o},t};