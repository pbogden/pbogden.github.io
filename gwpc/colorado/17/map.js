function ready(e,t,n,r,i){if(e)return console.error(e);console.log("objects:",r.objects.twnshp),console.log("first entry:",r.objects.twnshp.geometries[0].properties);var s=d3.set(r.objects.twnshp.geometries.map(function(e){return e.properties.lndkey}));console.log("unique lndkey = ",s.values());var o=t.objects.co,u=topojson.merge(t,o.geometries),a=path.bounds(u),f=.95/Math.max((a[1][0]-a[0][0])/width,(a[1][1]-a[0][1])/height),l=[(width-f*(a[1][0]+a[0][0]))/2,(height-f*(a[1][1]+a[0][1]))/2];console.log("scale & translate:",f,l),projection.scale(f).translate(l),svg.append("path").datum(u).attr("class","state").attr("d",path),svg.append("path").datum(topojson.mesh(t,o,function(e,t){return e!==t})).attr("class","counties").attr("d",path),svg.selectAll(".county").data(topojson.feature(t,o).features).enter().append("path").attr("class","county").attr("d",path).on("click",clicked),svg.selectAll("path.first").data(topojson.feature(n,n.objects.first).features).enter().append("path").attr("class","first").attr("d",path),svg.selectAll("path.twnshp").data(topojson.feature(r,r.objects.twnshp).features).enter().append("path").attr("class","twnshp").attr("d",path)}function clicked(e){projection.scale(1).translate([0,0]);var t=path.bounds(e),n=.95/Math.max((t[1][0]-t[0][0])/width,(t[1][1]-t[0][1])/height),r=[(width-n*(t[1][0]+t[0][0]))/2,(height-n*(t[1][1]+t[0][1]))/2];projection.scale(n).translate(r),svg.selectAll("path").attr("d",path),d3.selectAll(".county").style("fill-opacity",0),d3.select(this).style("fill-opacity",.1)}var width=550,height=500,projection=d3.geo.albers().scale(1).translate([0,0]),path=d3.geo.path().projection(projection),svg=d3.select("body").append("svg").attr("width",width).attr("height",height),rect="&minlatitude=36&maxlatitude=42&minlongitude=-110&maxlongitude=-101";queue().defer(d3.json,"co.json").defer(d3.json,"adams_first.json").defer(d3.json,"adams_twnshp.json").defer(d3.json,"adams_ladesc.json").await(ready)