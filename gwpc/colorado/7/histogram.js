d3.histogram=function(){var size=[600,500],nbins=10,nticks=5,data=d3.range(1e3).map(function(){return d3.random.normal()()});var margin={top:50,right:30,bottom:30,left:30},width=size[0]-margin.right-margin.left,height=size[1]-margin.top-margin.bottom,formatCount=d3.format(",.0f"),div,x;function histogram(){div=d3.select("body").append("div").attr("id","histogram");x=d3.scale.linear().domain(d3.extent(data)).range([0,width]).nice();var hist=d3.layout.histogram().bins(x.ticks(nbins))(data);var xAxis=d3.svg.axis().scale(x).ticks(nticks).orient("bottom");var y=d3.scale.linear().domain([0,d3.max(hist,function(d){return d.y})]).range([height,0]);var svg=div.append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate ("+margin.left+", "+margin.top+")");var bar=svg.selectAll(".bar").data(hist).enter().append("g").attr("class","bar").attr("transform",function(d){return"translate("+x(d.x)+", "+y(d.y)+")"});bar.append("rect").attr("x",function(d){return 0}).attr("width",function(d){return x(d.dx)-x(0)}).attr("height",function(d){return height-y(d.y)});bar.append("text").attr("dy","-.5em").attr("dx",function(d){return(x(d.dx)-x(0))/2}).attr("text-anchor","middle").style("font","14px sans-serif").style("fill","#333").style("stroke","#333").text(function(d){return d.y!=0?formatCount(d.y):null});svg.append("g").attr("class","x axis").style("font","14px sans-serif").attr("transform","translate (0,"+height+")").call(xAxis);return histogram}histogram.verticals=function(extent){var svg=div.select("svg g");svg.selectAll(".vertical").remove();svg.selectAll("circle.vertical").data(extent).enter().append("circle").attr("class","vertical").attr("cx",function(d){return x(d)}).attr("cy",0).attr("r",5).style("fill","red").style("fill-opacity",1).style("stroke-width",1).style("stroke","black");svg.selectAll("line.vertical").data(extent).enter().append("line").attr("class","vertical").attr("x1",function(d){return x(d)}).attr("x2",function(d){return x(d)}).attr("y1",2.5).attr("y2",height).attr("stroke","black").attr("stroke-width",1);return histogram};histogram.clear=function(){d3.select("#histogram svg").remove();return histogram};histogram.size=function(_){if(!arguments.length)return size;size=_;return histogram};histogram.data=function(_){if(!arguments.length)return data;data=_;return histogram};histogram.nbins=function(_){if(!arguments.length)return nbins;nbins=_;return histogram};histogram.ticks=function(_){if(!arguments.length)return nticks;nticks=_;return histogram};return histogram};