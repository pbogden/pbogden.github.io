d3.colorado=function(){function h(){return d3.select("#colorado").node()!==null?h:(r=e[0],i=e[1],o=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",v),s=d3.select("body").append("div").attr("id","colorado").append("svg").attr("width",r).attr("height",i).style("stroke-width",1).call(o),s=s.append("g"),s.append("g").attr("class","voronoi"),s.append("g").attr("class","well-clip"),s.append("g").attr("class","well-location"),s.append("g").attr("class","color-scale"),s.append("g").append("circle").attr("id","well-dot").attr("cx",null).attr("cy",null).attr("r",f),s.append("g").append("circle").attr("id","well-highlight").style("stroke","none").style("stroke-opacity",.5).style("stroke-width",8).style("fill","none").attr("cx",null).attr("cy",null).attr("r",5),l.scale(1).translate([0,0]),d3.json("co.json",function(e,t){var n=t.objects.co,o=topojson.merge(t,n.geometries),u=c.bounds(o),a=.95/Math.max((u[1][0]-u[0][0])/r,(u[1][1]-u[0][1])/i),f=[(r-a*(u[1][0]+u[0][0]))/2,(i-a*(u[1][1]+u[0][1]))/2];a=12490,f=[1783,541],l.scale(a).translate(f),s.append("path").datum(o).attr("class","state").attr("d",c),s.append("path").datum(topojson.mesh(t,n,function(e,t){return e!==t})).attr("class","county-border").attr("d",c)}),h)}function p(){var e=20,t=2*e,n=.66*i,r=s.select(".color-scale").selectAll(".colors").data(a.range());r.exit().remove(),r.enter().append("rect").attr("class","colors").attr("width",e).attr("height",e).style("stroke","#666").style("stroke-width","1px"),r.attr("x",t).attr("y",function(t,r){return n-r*e}).style("fill",function(e){return e});var o=s.select(".color-scale").selectAll(".color-labels").data(a.domain());o.exit().remove(),o.enter().append("text").attr("class","color-labels").attr("dx","1em").attr("dy","1em").attr("font-size","14px"),o.attr("x",t+e).attr("y",function(t,r){return n-r*e}).text(function(e){return e==-9?"no data":e})}function d(e,t){return typeof e=="undefined"&&console.log("bad polygon for i = ",t,e),typeof e=="undefined"&&console.log(),typeof e!="undefined"?"M"+e.join("L")+"Z":null}function v(){s.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}var e=[600,500],t,n=d3.format(",.0f"),r,i,s,o,u,a,f=1,l=d3.geo.albers(),c=d3.geo.path().pointRadius(2).projection(l);return h.clear=function(){return d3.select("#colorado").remove(),h},h.plotem=function(){return s.selectAll("path.circle").remove(),s.selectAll("path.circle").data(t.map(function(e){return e.location})).enter().append("path").attr("class","circle").style("fill","steelblue").style("stroke","black").attr("d",c),s.call(o.event),h},h.voronoi=function(){d3.select("#well-info").html(" ");var e=t.map(function(e){return d3.merge([l(e.location.coordinates),[e.value]])}),n=d3.extent(e,function(e){return e[0]}),r=d3.extent(e,function(e){return e[1]}),i=d3.geom.voronoi().clipExtent([[n[0]-20,r[0]-20],[n[1]+20,r[1]+20]]),u=e.map(function(e){return+e[2]});u=u.sort(d3.descending),range=d3.extent(u),console.log("range before",range),range=d3.extent(u.filter(function(e,t,n){return t>5&&t<n.length-5})),console.log("range after",range),a=d3.scale.linear().domain([range[0]-500,range[0],range[1],range[1]+500]).range(["blue","yellow","red","green"]);var c=s.select(".well-clip").selectAll("clipPath").data(e);c.exit().remove(),c.enter().append("clipPath").attr("id",function(e,t){return"clip-"+t}).append("circle").attr("r",20),c.select("circle").attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]});var h=s.select(".voronoi").selectAll("path").data(i(e));h.exit().remove(),h.enter().append("path"),h.attr("clip-path",function(e,t){return"url(#clip-"+t+")"}).style("fill",function(t,n){return a(e[n][2])}).attr("d",d).on("mouseover",function(t,n){var r=s.select(".well-location #well-"+n);s.select("#well-dot").attr("cx",r.attr("cx")).attr("cy",r.attr("cy")).style("fill",a(e[n][2])),s.select("#well-highlight").style("stroke","black").attr("cx",r.attr("cx")).attr("cy",r.attr("cy"))});var v=s.select(".well-location").selectAll("circle").data(e);v.exit().remove(),v.enter().append("circle").style("fill","black").attr("r",f),v.attr("id",function(e,t){return"well-"+t}).attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}),p(),s.call(o.event)},h.size=function(t){return arguments.length?(e=t,h):e},h.data=function(e){return arguments.length?(t=e,h):t},h}