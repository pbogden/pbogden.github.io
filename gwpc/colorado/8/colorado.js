d3.colorado=function(){var size=[600,500],data;var formatCount=d3.format(",.0f"),width,height,div,svg,zoom,x;var projection=d3.geo.albers();var path=d3.geo.path().pointRadius(2).projection(projection);function colorado(){if(d3.select("#colorado").node()!==null)return colorado;div=d3.select("body").append("div").attr("id","colorado");width=size[0];height=size[1];svg=div.append("svg").attr("width",width).attr("height",height).style("stroke-width",1).on("click",function(){console.log("svg clicked")});zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",zoomed);svg.call(zoom).call(zoom.event);svg=svg.append("g");projection.scale(1).translate([0,0]);d3.json("co.json",function(err,co){var objects=co.objects.co;var all=topojson.merge(co,objects.geometries);var b=path.bounds(all),s=.95/Math.max((b[1][0]-b[0][0])/width,(b[1][1]-b[0][1])/height),t=[(width-s*(b[1][0]+b[0][0]))/2,(height-s*(b[1][1]+b[0][1]))/2];s=12490;t=[1783,541];projection.scale(s).translate(t);svg.append("path").datum(all).attr("class","state").attr("d",path);svg.append("path").datum(topojson.mesh(co,objects,function(a,b){return a!==b})).attr("class","county-border").attr("d",path)});return colorado}colorado.clear=function(){d3.select("#colorado").remove();return colorado};colorado.plotem=function(){svg.selectAll("path.circle").remove();svg.selectAll("path.circle").data(data.map(function(d){return d.location})).enter().append("path").attr("class","circle").style("fill","steelblue").style("stroke","black").attr("d",path);svg.call(zoom.event);return colorado};colorado.voronoi=function(){svg.selectAll(".voronoi").remove();var vertices=data.map(function(d){return projection(d.location.coordinates)});var dx=d3.extent(vertices,function(d){return d[0]});var dy=d3.extent(vertices,function(d){return d[1]});var voronoi=d3.geom.voronoi().clipExtent([[dx[0]-5,dy[0]-5],[dx[1]+5,dy[1]+5]]);var values=data.map(function(d){return+d.value});values=values.sort(d3.descending);range=d3.extent(values);console.log("range before",range);range=d3.extent(values.filter(function(d,i,arr){return i>5&&i<arr.length-5}));console.log("range after",range);var color=d3.scale.linear().domain([range[0]-500,range[0],range[1],range[1]+500]).range(["blue","yellow","red","green"]);var path=svg.append("g").selectAll("path.voronoi").data(voronoi(vertices)).enter().append("path").attr("class","voronoi").style("fill",function(d,i){return color(data[i].value)}).attr("d",polygon).on("mouseover",function moused(d,i){console.log("moused voronoi",vertices[i][2])});svg.selectAll("circle").data(vertices).enter().append("circle").attr("class","voronoi").style("fill",function(d,i){return color(data[i].value)}).style("stroke","black").attr("cx",function(d){return d[0]}).attr("cy",function(d){return d[1]}).attr("r",3);svg.call(zoom.event)};function polygon(d,i){if(typeof d=="undefined")console.log("bad polygon for i = ",i,d);return typeof d!="undefined"?"M"+d.join("L")+"Z":null}function zoomed(){console.log("zoomed");svg.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");svg.style("stroke-width",1/d3.event.scale+"px");svg.selectAll("circle").attr("r",3/d3.event.scale)}colorado.size=function(_){if(!arguments.length)return size;size=_;return colorado};colorado.data=function(_){if(!arguments.length)return data;data=_;return colorado};return colorado};