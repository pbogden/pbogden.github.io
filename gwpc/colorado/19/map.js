function ready(e,t){if(e)return console.error(e);console.log(t.objects.co.geometries[0]);var n=t.objects.co,r=topojson.merge(t,n.geometries),i=path.bounds(r),s=.95/Math.max((i[1][0]-i[0][0])/width,(i[1][1]-i[0][1])/height),o=[(width-s*(i[1][0]+i[0][0]))/2,(height-s*(i[1][1]+i[0][1]))/2];console.log("scale & translate:",s,o),projection.scale(s).translate(o),svg.append("path").datum(r).attr("class","state").attr("d",path),svg.selectAll("path.county").data(topojson.feature(t,n).features).enter().append("path").attr("class","county").attr("d",path).on("click",clicked)}function clicked(e,t){projection.scale(1).translate([0,0]);var n=path.bounds(e),r=.95/Math.max((n[1][0]-n[0][0])/width,(n[1][1]-n[0][1])/height),i=[(width-r*(n[1][0]+n[0][0]))/2,(height-r*(n[1][1]+n[0][1]))/2];r<4e4&&(r=4e4,projection.scale(1).translate([0,0]),n=path.bounds(e),i=[(width-r*(n[1][0]+n[0][0]))/2,(height-r*(n[1][1]+n[0][1]))/2]),console.log("new scale & translate:",r,i),projection.scale(r).translate(i),svg.selectAll("g.vectors").remove(),svg.selectAll("path.state").transition().duration(1e3).attr("d",path),svg.selectAll("path.county").transition().duration(1e3).attr("d",path),setTimeout(function(){var e=svg.selectAll("g.vectors").data(tiler.scale(projection.scale()*2*Math.PI).translate(projection([0,0])));e.enter().append("g").attr("class","vectors").each(function(e){var t=d3.select(this);d3.json(url(e),function(e,n){var r=t.selectAll("path").data(n.features.sort(function(e,t){return e.properties.sort_key-t.properties.sort_key}));r.enter().append("path").attr("class",function(e){return e.properties.kind}).attr("d",path),r.attr("d",path),r.exit().remove()})}),e.each(function(e){var t=d3.select(this);d3.json(url(e),function(e,n){var r=t.selectAll("path").data(n.features.sort(function(e,t){return e.properties.sort_key-t.properties.sort_key}));r.enter().append("path").attr("class",function(e){return e.properties.kind}).attr("d",path),r.attr("d",path),r.exit().remove()})}),e.exit().remove()},1e3)}function url(e){var t=".tile.openstreetmap.us/vectiles-highroad/";return"http://"+["a","b","c"][(e[0]*31+e[1])%3]+t+e[2]+"/"+e[0]+"/"+e[1]+".json"}var width=960,height=500,projection=d3.geo.mercator().scale(1).translate([0,0]),path=d3.geo.path().projection(projection),tiler=d3.geo.tile().size([width,height]),svg=d3.select("body").append("svg").attr("width",width).attr("height",height);queue().defer(d3.json,"co.json").await(ready)