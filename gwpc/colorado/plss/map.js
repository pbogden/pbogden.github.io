function ready(e,t,n,r){vector.selectAll("path.twnshp").data(topojson.feature(n,n.objects.twnshp).features).enter().append("path").attr("class","twnshp"),vector.selectAll("path.county").data(topojson.feature(t,t.objects.co).features).enter().append("path").attr("class","county").attr("d",path).on("dblclick",dblclicked).on("mouseover",mousedover).on("mouseout",mousedout),svg.call(zoom).on("dblclick.zoom",null),zoomed()}function mousedover(e){place.text(e.properties.COUNTY||"Township: "+e.properties.label)}function mousedout(e){place.text("")}function dblclicked(e){var t=d3.geo.mercator().scale(1).translate([0,0]),n=d3.geo.path().projection(t),r=n.bounds(e),i=.9/Math.max((r[1][0]-r[0][0])/width,(r[1][1]-r[0][1])/height),s=[(width-i*(r[1][0]+r[0][0]))/2,(height-i*(r[1][1]+r[0][1]))/2];t.scale(i),vector.selectAll("path.county").attr("d",n),vector.selectAll("path.twnshp").attr("d",n),vector.selectAll("path.county").style("pointer-events","none").on("dblclick",null).on("mouseover",null).on("mouseout",null),vector.selectAll("path.twnshp").style("pointer-events","all").on("dblclick",dblclicked).on("mouseover",mousedover).on("mouseout",mousedout),k0=i*2*Math.PI,zoom.scale(k0).translate(s),zoomed()}function zoomed(){var e=tile.scale(zoom.scale()).translate(zoom.translate())();projection.scale(zoom.scale()/2/Math.PI).translate(zoom.translate()),vector.attr("transform","translate("+zoom.translate()+")scale("+zoom.scale()/k0+")").style("stroke-width",k0/zoom.scale());var t=raster.attr("transform","scale("+e.scale+")translate("+e.translate+")").selectAll("image").data(e,function(e){return e});t.exit().remove(),t.enter().append("image").attr("xlink:href",function(e){return"http://"+["a","b","c","d"][Math.random()*4|0]+".tiles.mapbox.com/v3/examples.map-i86nkdio/"+e[2]+"/"+e[0]+"/"+e[1]+".png"}).attr("width",1).attr("height",1).attr("x",function(e){return e[0]}).attr("y",function(e){return e[1]})}function mousemoved(){info.text(formatLocation(projection.invert(d3.mouse(this)),zoom.scale()))}function formatLocation(e,t){var n=d3.format("."+Math.floor(Math.log(t)/2-2)+"f");return(e[1]<0?n(-e[1])+"째S":n(e[1])+"째N")+" "+(e[0]<0?n(-e[0])+"째W":n(e[0])+"째E")}var width=960,height=500,z0=7,k0=1<<z0+8,tile=d3.geo.tile().size([width,height]),projection=d3.geo.mercator().scale(k0/2/Math.PI).translate([0,0]),path=d3.geo.path().projection(projection),center=projection([-105.55,39]),zoom=d3.behavior.zoom().scale(k0).scaleExtent([256,1<<23]).center([width/2,height/2]).translate([width/2-center[0],height/2-center[1]]).on("zoom",zoomed),svg=d3.select("body").append("svg").attr("width",width).attr("height",height).on("mousemove",mousemoved),raster=svg.append("g"),vector=svg.append("g"),info=d3.select("body").append("div").attr("class","info"),place=d3.select("body").append("div").attr("class","place");queue().defer(d3.json,"co.json").defer(d3.json,"twnshp.json").await(ready)