d3.wells=function(){function d(o){function u(e,s,u,h,p){t=d3.map(u),p.features=p.features.filter(function(e){return+e.properties.mag>=f}),a=p;var d=s.objects.co,b=topojson.merge(s,d.geometries),E=Object.keys(h.objects).map(function(e){return topojson.feature(h,h.objects[e])}),S=c.bounds(b),x=.95/Math.max((S[1][0]-S[0][0])/n,(S[1][1]-S[0][1])/r),T=[(n-x*(S[1][0]+S[0][0]))/2,(r-x*(S[1][1]+S[0][1]))/2];l.scale(x).translate(T);var N=i.append("g");N.append("path").datum(b).attr("class","state").attr("d",c),N.append("defs").append("clipPath").attr("id","state-clip").append("path").datum(b).attr("d",c),N.append("path").datum(topojson.mesh(s,d,function(e,t){return e!==t})).attr("class","county-border").attr("d",c),N.selectAll(".basin").data(E[0].features).enter().append("path").attr("class","basin").attr("clip-path","url(#state-clip)").attr("d",c).on("mouseover",v).on("mousemove",g).on("mouseout",y),N.selectAll(".play").data(E[1].features).enter().append("path").attr("class","play").classed("prospective",function(e){return e.properties.Current==="N"}).attr("clip-path","url(#state-clip)").attr("d",c).on("mouseover",m).on("mousemove",g).on("mouseout",y),w([]),o()}return arguments.length||(o=function(){console.log("Done initializing d3.wells")}),d3.select("#wells").node()!==null?d:(n=e[0],r=e[1],i=d3.select("body").append("svg").attr("width",n).attr("height",r),s=d3.select("body").append("svg").attr("width",960-n).attr("height",r),queue().defer(d3.json,"co.json").defer(d3.json,"data.json").defer(d3.json,"shalegasplay.json").defer(d3.json,"quakes.json").await(u),i.append("text").attr("x",.4*n).attr("y",.1*r).attr("dy","-1em").style("font-size","20px").text("Injection Volumes"),d)}function v(e){h[0][0].innerHTML=e.properties.NAME+" Basin",h.style("visibility","visible"),h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function m(e){var t=e.properties.Shale_Play+" Play";e.properties.Current==="Y"&&(t+=" (current)"),e.properties.Current==="N"&&(t+=" (prospective)"),h[0][0].innerHTML=t,h.style("visibility","visible"),h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function g(e){h.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function y(e){h.style("visibility","hidden")}function b(e,t){console.log("moused",t,e);var n=Object.keys(e.values);n.splice(n.indexOf("location"),1);var r=e.values[n[0]];console.log("values before...first one:",r[0],", with this many:",r.length),r=r.map(function(e){return{x:new Date(+e.year,+e.month-1),y:+e.vol}}),console.log("values before...first one:",r[0],", with this many:",r.length),p.style("visibility","visible").html("API Number: "+e.api+", "+n[0]+", "+n.length),w(r)}function w(e){var t={top:10,right:20,bottom:50,left:80},n=+s.attr("width")-t.left-t.right,r=+s.attr("height")/2-t.top-t.bottom;d3.select("#myTimeSeries").remove();var i=s.append("g").attr("id","myTimeSeries").attr("transform","translate("+t.left+","+(+s.attr("height")/2+t.top)+")");typeof u=="undefined"&&(u=d3.time.scale().domain(d3.extent(e.map(function(e){return e.x}))).range([0,n]));var o=d3.scale.linear().domain([0,35e4]).range([r,0]),a=d3.svg.axis().scale(u).ticks(5).orient("bottom"),f=d3.svg.axis().scale(o).ticks(5).orient("left"),l=d3.svg.line().x(function(e){return u(e.x)}).y(function(e){return o(e.y)});i.selectAll("path").data([e]).enter().append("path").attr("class","line").attr("d",l),i.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(a),i.append("g").attr("class","y axis").call(f)}var e=[550,500],t,n,r,i,s,o=d3.format(",.0f"),u,a,f=2.5,l=d3.geo.albers().scale(1).translate([0,0]),c=d3.geo.path().pointRadius(5).projection(l),h=d3.select("body").append("div").attr("class","tooltip").style("visibility","hidden"),p=d3.select("body").append("div").attr("class","welltip").style("visibility","hidden");return d.plotem=function(){var e=[];t.forEach(function(t,n){typeof n.location!="undefined"&&e.push({api:t,values:n})});var s=i.selectAll(".formationLabel").data([o(e.length)+" of "+o(t.keys().length)+" wells"]);s.enter().append("text").attr("class","formationLabel").attr("x",.7*n).attr("y",.1*r).style("font-size","20px").text(String),s.text(String);var u=i.selectAll("path.circle").data(e);return u.exit().remove(),u.attr("d",function(e){return c(e.values.location)}),u.enter().append("path").attr("class","circle").style("fill","steelblue").style("stroke","black").style("stroke-width",.5).attr("d",function(e){return c(e.values.location)}).on("mouseover",b),d},d.plotQuakes=function(){var e,t=i.selectAll("path.quake").data(a.features);t.exit().remove(),t.attr("d",function(e){return c(e.values.location)}),t.enter().append("path").attr("class","quake").attr("d",c).on("mouseover",e);var s=i.selectAll(".quakesLabel").data([o(a.features.length)+" earthquakes"]);return s.enter().append("text").attr("class","quakesLabel").attr("x",.7*n).attr("y",.1*r).attr("dy","1.1em").style("font-size","20px").text(String),s.text(String),d},d.plotQuakeSeries=function(){function c(){function n(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=l.extent();l.empty()&&(e=h(e[0][0]),d3.selectAll(".brush").call(l.extent(e))),d3.selectAll("path.quake").style("visibility",function(e){return n(e)==1?"visible":"hidden"}).style("pointer-events",function(e){return n(e)==1?"all":"none"});var t=d3.selectAll("path.quake").filter(n)[0].length;d3.select(".quakesLabel").html(t+" Earthquakes")}function h(e){var t,n;return n=new Date(e),n.setFullYear(e.getFullYear()+1),n=n<u.domain()[1]?n:u.domain()[1],t=new Date(n),t.setFullYear(n.getFullYear()-1),[[t,i.domain()[0]],[n,i.domain()[1]]]}var e={top:30,right:20,bottom:80,left:80},t=+s.attr("width")-e.left-e.right,n=+s.attr("height")/2-e.top-e.bottom,r=s.append("g").attr("transform","translate("+e.left+","+e.top+")");u=d3.time.scale().domain(d3.extent(a.features.map(function(e){return e.properties.time}))).range([0,t]);var i=d3.scale.linear().domain(d3.extent(a.features.map(function(e){return+e.properties.mag}))).range([n,0]),o=d3.svg.axis().scale(u).ticks(6).orient("bottom"),f=d3.svg.axis().scale(i).ticks(5).orient("left"),l=d3.svg.brush().x(u).y(i).extent([[u.domain()[0],i.domain()[0]],[u.domain()[1],i.domain()[1]]]).on("brush",c);return r.selectAll("circle.quake").data(a.features).enter().append("circle").attr("class","quake").attr("cx",function(e){return u(+e.properties.time)}).attr("cy",function(e){return i(+e.properties.mag)}).attr("r",3),r.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(o),r.append("g").attr("class","y axis").call(f),r.attr("class","brush").call(l),d},d.size=function(t){return arguments.length?(e=t,d):e},d.data=function(e){return arguments.length?(t=e,d):t},d}