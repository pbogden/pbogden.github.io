d3.wells=function(){function b(n){function r(e,r,i,s,u){if(e)throw e;t=i,u.features=u.features.filter(function(e){return+e.properties.mag>=d}),p=u;var a=r.objects.co,f=topojson.merge(r,a.geometries),l=Object.keys(s.objects).map(function(e){return topojson.feature(s,s.objects[e])}),c=o.append("g");c.append("path").datum(f).attr("class","state").attr("d",m).on("click",w),c.append("defs").append("clipPath").attr("id","state-clip").append("path").datum(f).attr("d",m),c.append("path").datum(topojson.mesh(r,a,function(e,t){return e!==t})).attr("class","county-border").attr("d",m).on("click",w),c.selectAll(".basin").data(l[0].features).enter().append("path").attr("class","basin").attr("clip-path","url(#state-clip)").attr("d",m).on("mouseover",E).on("mousemove",x).on("mouseout",T).on("click",w),c.selectAll(".play").data(l[1].features).enter().append("path").attr("class","play").classed("prospective",function(e){return e.properties.Current==="N"}).attr("clip-path","url(#state-clip)").attr("d",m).on("mouseover",S).on("mousemove",x).on("mouseout",T).on("click",w),N([]),n()}return arguments.length||(n=function(){console.log("Done initializing d3.wells")}),d3.select("#wells").node()!==null?b:(i=e[0],s=e[1],o=d3.select("body").append("svg").attr("width",i).attr("height",s),u=d3.select("body").append("svg").attr("width",960-i).attr("height",s),a=d3.select("body").append("div").attr("class","wellinfo").style("visibility","hidden").style("padding","5px").style("background-color","#ddd"),queue().defer(d3.json,"co.json").defer(d3.json,"data.json").defer(d3.json,"shalegasplay.json").defer(d3.json,"quakes.json").await(r),o.append("text").attr("x",.4*i).attr("y",.1*s).attr("dy","-1em").style("font-size","20px").text("Disposal Wells"),b)}function w(e){var t,n,r;c?(t=i/2,n=s/2,r=1,c=!1):(t=d3.event.pageX,n=d3.event.pageY,r=4,c=!0),o.select("g").transition().duration(750).attr("transform","translate("+i/2+","+s/2+") scale("+r+") translate("+ -t+","+ -n+")").style("stroke-width",1.5/r+"px"),m.pointRadius(h/r),o.select("g").selectAll("path.well").transition().duration(750).attr("d",function(e){return m(e.location)}),o.select("g").selectAll("path.quake").transition().duration(750).attr("d",m)}function E(e){g[0][0].innerHTML=e.properties.NAME+" Basin",g.style("visibility","visible"),g.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function S(e){var t=e.properties.Shale_Play+" Play";e.properties.Current==="Y"&&(t+=" (current)"),e.properties.Current==="N"&&(t+=" (prospective)"),g[0][0].innerHTML=t,g.style("visibility","visible"),g.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function x(e){g.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function T(e){g.style("visibility","hidden")}function N(e){var t={top:10,right:20,bottom:50,left:80},n=+u.attr("width")-t.left-t.right,r=+u.attr("height")/2-t.top-t.bottom;d3.select("#myTimeSeries").remove();var i=u.append("g").attr("id","myTimeSeries").attr("transform","translate("+t.left+","+(+u.attr("height")/2+t.top)+")");typeof l=="undefined"&&(l=d3.time.scale().domain(d3.extent(e.map(function(e){return e.x}))).range([0,n]));var s=d3.scale.linear().domain([0,35e4]).range([r,0]),o=d3.svg.axis().scale(l).ticks(5).orient("bottom"),a=d3.svg.axis().scale(s).ticks(5).orient("left"),f=d3.svg.line().x(function(e){return l(e.x)}).y(function(e){return s(e.y)}),c=d3.svg.area().x(function(e){return l(e.x)}).y0(r).y1(function(e){return s(e.y)});i.selectAll("path.line").data([e]).enter().append("path").attr("class","line").attr("d",f),i.selectAll("path.area").data([e]).enter().append("path").attr("class","area").style("fill","steelblue").attr("d",c),i.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),i.append("g").attr("class","y axis").call(a),i.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-6).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text("barrels/month"),i.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",n/2).attr("y",-t.top).text("Injection Volume"),i.append("text").attr("class","api-number").style("text-anchor","end").attr("x",n).attr("dy","+1em").text("select a well (on map)"),i.append("text").attr("class","formation-code").style("text-anchor","end").attr("x",n).attr("dy","+2.2em").text("")}var e=[550,500],t,n=5198,r=[905,314],i,s,o,u,a,f=d3.format(",.0f"),l,c,h=5,p,d=2.5,v=d3.geo.albers().scale(n).translate(r),m=d3.geo.path().pointRadius(h).projection(v),g=d3.select("body").append("div").attr("class","tooltip").style("pointer-events","none").style("visibility","hidden"),y=d3.select("body").append("div").attr("class","welltip").style("visibility","hidden");return b.plotem=function(){function r(e,t){console.log("moused",e),o.selectAll("path.well").classed("active",!1),d3.select(this).classed("active",!0),values=e.data.map(function(e){return{x:new Date(+e.year,+e.month-1),y:+e.vol}}),console.log("values.length before",values.length),values=values.filter(function(e){return!isNaN(e.y)}),console.log("values.length after",values.length),N(values),d3.select(".api-number").text("API Number: "+e.api);var n=e.metadata==null?null:Object.keys(e.metadata),r=n==null?["No data"]:n.map(function(t){return t+": "+e.metadata[t]});a.style("visibility","visible").html(r.join().replace(/,/g,"<br>"))}var e=o.selectAll(".formationLabel").data([f(t.length)+" wells"]);e.enter().append("text").attr("class","formationLabel").attr("x",.7*i).attr("y",.1*s).style("font-size","20px").text(String),e.text(String);var n=o.select("g").selectAll("path.well").data(t);return n.exit().remove(),n.attr("d",function(e){return m(e.location)}),n.enter().append("path").attr("class","well").attr("d",function(e){return m(e.location)}).on("mouseover",r),b},b.plotQuakes=function(){var e,t=o.select("g").selectAll("path.quake").data(p.features);t.exit().remove(),t.attr("d",function(e){return m(e.values.location)}),t.enter().append("path").attr("class","quake").attr("d",m).on("mouseover",e);var n=o.selectAll(".quakesLabel").data([f(p.features.length)+" earthquakes"]);return n.enter().append("text").attr("class","quakesLabel").attr("x",.7*i).attr("y",.1*s).attr("dy","1.1em").style("font-size","20px").text(String),n.text(String),b},b.plotQuakeSeries=function(){function f(){function n(t){return t.properties.time>e[0][0]&&t.properties.time<e[1][0]&&t.properties.mag>=e[0][1]&&t.properties.mag<=e[1][1]?1:0}var e=a.extent();a.empty()&&(e=c(e[0][0]),d3.selectAll(".brush").call(a.extent(e))),d3.selectAll("path.quake").style("visibility",function(e){return n(e)==1?"visible":"hidden"});var t=d3.selectAll("path.quake").filter(n)[0].length;d3.select(".quakesLabel").html(t+" earthquakes")}function c(e){var t,n;return n=new Date(e),n.setFullYear(e.getFullYear()+1),n=n<l.domain()[1]?n:l.domain()[1],t=new Date(n),t.setFullYear(n.getFullYear()-2),[[t,i.domain()[0]],[n,i.domain()[1]]]}var e={top:30,right:20,bottom:80,left:80},t=+u.attr("width")-e.left-e.right,n=+u.attr("height")/2-e.top-e.bottom,r=u.append("g").attr("transform","translate("+e.left+","+e.top+")");l=d3.time.scale().domain(d3.extent(p.features.map(function(e){return e.properties.time}))).range([0,t]);var i=d3.scale.linear().domain(d3.extent(p.features.map(function(e){return+e.properties.mag}))).range([n,0]),s=d3.svg.axis().scale(l).ticks(6).orient("bottom"),o=d3.svg.axis().scale(i).ticks(5).orient("left");r.append("text").attr("class","y label").attr("text-anchor","end").attr("x",-6).attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text("magnitude"),r.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",t/2).attr("y",-e.top/2).attr("dy","+.75em").text("Earthquakes");var a=d3.svg.brush().x(l).y(i).extent(c(l.domain()[1])).on("brush",f);return r.selectAll("circle.quake-series").data(p.features).enter().append("circle").attr("class","quake-series").attr("cx",function(e){return l(+e.properties.time)}).attr("cy",function(e){return i(+e.properties.mag)}).attr("r",3),r.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(s),r.append("g").attr("class","y axis").call(o),r.attr("class","brush").call(a),f(),b},b.size=function(t){return arguments.length?(e=t,b):e},b.data=function(e){return arguments.length?(t=e,b):t},b}