d3.wells=function(){function l(s){function a(e,a,f,l){t=d3.map(f),console.log("wellData.keys()",t.keys()),kk=t.keys()[0],vv=t.get(kk),console.log("kk,vv",kk,vv);var v=a.objects.co,m=topojson.merge(a,v.geometries),g=Object.keys(l.objects).map(function(e){return topojson.feature(l,l.objects[e])}),y=u.bounds(m),b=.95/Math.max((y[1][0]-y[0][0])/n,(y[1][1]-y[0][1])/r),w=[(n-b*(y[1][0]+y[0][0]))/2,(r-b*(y[1][1]+y[0][1]))/2];o.scale(b).translate(w);var E=i.append("g");E.append("path").datum(m).attr("class","state").attr("d",u),E.append("defs").append("clipPath").attr("id","state-clip").append("path").datum(m).attr("d",u),E.append("path").datum(topojson.mesh(a,v,function(e,t){return e!==t})).attr("class","county-border").attr("d",u),E.selectAll(".basin").data(g[0].features).enter().append("path").attr("class","basin").attr("clip-path","url(#state-clip)").attr("d",u).on("mouseover",c).on("mousemove",p).on("mouseout",d),E.selectAll(".play").data(g[1].features).enter().append("path").attr("class","play").classed("prospective",function(e){return e.properties.Current==="N"}).attr("clip-path","url(#state-clip)").attr("d",u).on("mouseover",h).on("mousemove",p).on("mouseout",d),s()}return arguments.length||(s=function(){console.log("Done initializing d3.wells")}),d3.select("#wells").node()!==null?l:(n=e[0],r=e[1],i=d3.select("body").append("svg").attr("width",n).attr("height",r),queue().defer(d3.json,"co.json").defer(d3.json,"data.json").defer(d3.json,"shalegasplay.json").await(a),i.append("text").attr("x",.4*n).attr("y",.1*r).attr("dy","-1em").style("font-size","20px").text("Injection Volumes"),l)}function c(e){a[0][0].innerHTML=e.properties.NAME+" Basin",a.style("visibility","visible"),a.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function h(e){var t=e.properties.Shale_Play+" Play";e.properties.Current==="Y"&&(t+=" (current)"),e.properties.Current==="N"&&(t+=" (prospective)"),a[0][0].innerHTML=t,a.style("visibility","visible"),a.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function p(e){a.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+20+"px")}function d(e){a.style("visibility","hidden")}function v(e,t){console.log("moused",t,e);var n=Object.keys(e.values);f.style("visibility","visible").html("API Number: "+e.api),n.splice(n.indexOf("location"),1);var r=e.values[n[0]];console.log("values before...first one:",r[0],", with this many:",r.length),r=r.map(function(e){return{x:new Date(+e.year,+e.month-1),y:+e.vol}}),console.log("values before...first one:",r[0],", with this many:",r.length),m(r)}function m(e){var t={top:10,right:20,bottom:50,left:80},n=450-t.left-t.right,r=450-t.top-t.bottom;d3.select("#myTimeSeries").remove();var i=d3.select("body").append("svg").attr("width",n+t.left+t.right).attr("height",r+t.top+t.bottom).attr("id","myTimeSeries").append("g").attr("transform","translate("+t.left+","+t.top+")"),s=i.append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",r),o=d3.time.scale().domain(d3.extent(e.map(function(e){return e.x}))).range([0,n]),u=d3.scale.linear().domain(d3.extent(e.map(function(e){return e.y}))).range([r,0]),a=d3.svg.axis().scale(o).ticks(5).orient("bottom"),f=d3.svg.axis().scale(u).ticks(5).orient("left"),l=d3.svg.line().x(function(e){return o(e.x)}).y(function(e){return u(e.y)});i.append("path").datum(e).attr("class","line").attr("d",l),i.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(a),i.append("g").attr("class","y axis").call(f)}var e=[600,500],t,n,r,i,s=d3.format(",.0f"),o=d3.geo.albers().scale(1).translate([0,0]),u=d3.geo.path().pointRadius(5).projection(o),a=d3.select("body").append("div").attr("class","tooltip").style("visibility","hidden"),f=d3.select("body").append("div").attr("class","welltip").style("visibility","hidden");return l.plotem=function(){var e=[];t.forEach(function(t,n){typeof n.location!="undefined"&&e.push({api:t,values:n})});var o=i.selectAll(".formationLabel").data([s(e.length)+" of "+s(t.keys().length)+" wells"]);o.enter().append("text").attr("class","formationLabel").attr("x",.75*n).attr("y",.1*r).style("font-size","20px").text(String),o.text(String);var a=i.selectAll("path.circle").data(e);return a.exit().remove(),a.attr("d",function(e){return u(e.values.location)}),a.enter().append("path").attr("class","circle").style("fill","steelblue").style("stroke","black").style("stroke-width",.5).attr("d",function(e){return u(e.values.location)}).on("mouseover",v),l},l.size=function(t){return arguments.length?(e=t,l):e},l.data=function(e){return arguments.length?(t=e,l):t},l}